(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{423:function(v,_,t){"use strict";t.r(_);var a=t(14),r=Object(a.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"服务端设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#服务端设计"}},[v._v("#")]),v._v(" 服务端设计")]),v._v(" "),_("h2",{attrs:{id:"接口设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#接口设计"}},[v._v("#")]),v._v(" 接口设计")]),v._v(" "),_("h3",{attrs:{id:"需要设计的接口"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#需要设计的接口"}},[v._v("#")]),v._v(" 需要设计的接口")]),v._v(" "),_("ul",[_("li",[v._v("登录功能")]),v._v(" "),_("li",[v._v("用户信息接口")]),v._v(" "),_("li",[v._v("作品接口")]),v._v(" "),_("li",[v._v("模板接口")])]),v._v(" "),_("h2",{attrs:{id:"登录功能的设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#登录功能的设计"}},[v._v("#")]),v._v(" 登录功能的设计")]),v._v(" "),_("h3",{attrs:{id:"回顾jwt的过程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#回顾jwt的过程"}},[v._v("#")]),v._v(" 回顾jwt的过程")]),v._v(" "),_("ul",[_("li",[v._v("前端输入用户名和密码，传给后端")]),v._v(" "),_("li",[v._v("后端验证成功，返回一段token字符串 - 将用户信息加密之后得到")]),v._v(" "),_("li",[v._v("前端获取token之后 存储下来")]),v._v(" "),_("li",[v._v("以后访问接口，都在header中携带这段token")])]),v._v(" "),_("h3",{attrs:{id:"初次获取验证码"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#初次获取验证码"}},[v._v("#")]),v._v(" 初次获取验证码")]),v._v(" "),_("ul",[_("li",[v._v("request 用户输入手机号 请求短信验证码接口")]),v._v(" "),_("li",[v._v("server 调用云服务获取随机数验证码 返回给服务端 服务端拿到之后，将内容缓存起来2min。")]),v._v(" "),_("li",[v._v("res 返回给用户发送成功，触发短信服务")])]),v._v(" "),_("h3",{attrs:{id:"再次获取验证码"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#再次获取验证码"}},[v._v("#")]),v._v(" 再次获取验证码")]),v._v(" "),_("ul",[_("li",[v._v("request 用户输入手机号 请求短信验证码接口")]),v._v(" "),_("li",[v._v("server 检查缓存 没有则生成 并再次缓存")]),v._v(" "),_("li",[v._v("res\n"),_("ul",[_("li",[v._v("有缓存 则返回错误，用户频繁请求了")]),v._v(" "),_("li",[v._v("发送短信验证码 并返回给前端说发送成功了")])])])]),v._v(" "),_("h3",{attrs:{id:"登录验证"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#登录验证"}},[v._v("#")]),v._v(" 登录验证")]),v._v(" "),_("ul",[_("li",[v._v("request 用户输入手机号 和验证码")]),v._v(" "),_("li",[v._v("server 匹配缓存")]),v._v(" "),_("li",[v._v("res\n"),_("ul",[_("li",[v._v("匹配成功 则验证通过")]),v._v(" "),_("li",[v._v("匹配失败 则验证不通过")])])])]),v._v(" "),_("h2",{attrs:{id:"用户信息接口的设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#用户信息接口的设计"}},[v._v("#")]),v._v(" 用户信息接口的设计")]),v._v(" "),_("ul",[_("li",[v._v("获取手机短信验证码")]),v._v(" "),_("li",[v._v("登录")]),v._v(" "),_("li",[v._v("获取用户的信息")]),v._v(" "),_("li",[v._v("修改用户的信息")])]),v._v(" "),_("h2",{attrs:{id:"代码目录设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#代码目录设计"}},[v._v("#")]),v._v(" 代码目录设计")]),v._v(" "),_("ul",[_("li",[v._v("routers/users.js")]),v._v(" "),_("li",[v._v("controller/users/")]),v._v(" "),_("li",[v._v("service/users.js")]),v._v(" "),_("li",[v._v("catch/users/")]),v._v(" "),_("li",[v._v("接口测试")])]),v._v(" "),_("h3",{attrs:{id:"功能范围"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#功能范围"}},[v._v("#")]),v._v(" 功能范围")]),v._v(" "),_("ul",[_("li",[v._v("B端 用户注册 作品管理  模板")]),v._v(" "),_("li",[v._v("编辑器 单个作品的内容获取 修改  预览和发布")])]),v._v(" "),_("h3",{attrs:{id:"功能拆分"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#功能拆分"}},[v._v("#")]),v._v(" 功能拆分")]),v._v(" "),_("ul",[_("li",[v._v("用户信息")]),v._v(" "),_("li",[v._v("作品管理")]),v._v(" "),_("li",[v._v("模板")]),v._v(" "),_("li",[v._v("编辑器")]),v._v(" "),_("li",[v._v("工具类")])]),v._v(" "),_("h3",{attrs:{id:"用户信息"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#用户信息"}},[v._v("#")]),v._v(" 用户信息")]),v._v(" "),_("ul",[_("li",[v._v("获取手机短信验证码")]),v._v(" "),_("li",[v._v("登录 包括注册")]),v._v(" "),_("li",[v._v("获取用户信息")]),v._v(" "),_("li",[v._v("修改用户信息")])]),v._v(" "),_("h2",{attrs:{id:"作品管理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#作品管理"}},[v._v("#")]),v._v(" 作品管理")]),v._v(" "),_("ul",[_("li",[v._v("创建空白作品")]),v._v(" "),_("li",[v._v("复制作品 通过模板创建 （模板其实就是作品，只是有一个标志而已，数据库设计中可以看出来）")]),v._v(" "),_("li",[v._v("删除作品")]),v._v(" "),_("li",[v._v("回复作品")]),v._v(" "),_("li",[v._v("转增作品")]),v._v(" "),_("li",[v._v("我的作品列表（搜索分页）")]),v._v(" "),_("li",[v._v("我的回收列表（搜索分页）")])]),v._v(" "),_("h3",{attrs:{id:"模板"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#模板"}},[v._v("#")]),v._v(" 模板")]),v._v(" "),_("ul",[_("li",[v._v("首页推荐模板列表 （搜索、分页） —— 不需要登录检验")]),v._v(" "),_("li",[v._v("获取单个模板信息 ——— 不需要登录校验")]),v._v(" "),_("li",[v._v("我的模板列表 （搜索分页）")])]),v._v(" "),_("h3",{attrs:{id:"编辑器"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编辑器"}},[v._v("#")]),v._v(" 编辑器")]),v._v(" "),_("p",[v._v("这个编辑器的设计要分开，但是代码中可能会和作品管理写在一起，因为都是针对作品的")]),v._v(" "),_("ul",[_("li",[v._v("查询单个作品信息")]),v._v(" "),_("li",[v._v("保存作品")]),v._v(" "),_("li",[v._v("预览作品")]),v._v(" "),_("li",[v._v("发布作品")]),v._v(" "),_("li",[v._v("发布为模板")])]),v._v(" "),_("h2",{attrs:{id:"数据库设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据库设计"}},[v._v("#")]),v._v(" 数据库设计")]),v._v(" "),_("h3",{attrs:{id:"需要存储的数据"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#需要存储的数据"}},[v._v("#")]),v._v(" 需要存储的数据")]),v._v(" "),_("ul",[_("li",[v._v("用户")]),v._v(" "),_("li",[v._v("项目/模板 （包含项目的内容、组件信息）")]),v._v(" "),_("li",[v._v("渠道")])]),v._v(" "),_("h3",{attrs:{id:"数据库选型和使用场景"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据库选型和使用场景"}},[v._v("#")]),v._v(" 数据库选型和使用场景")]),v._v(" "),_("ul",[_("li",[v._v("mysql 是关系型数据库 mongo 是文件数据库")]),v._v(" "),_("li",[v._v("一个用于存储表格形式 格式规整的数据 一个用于存储文件 格式零散的数据")])]),v._v(" "),_("p",[v._v("对于我们的服务来说，我们的作品信息，用户信息 适合存储在mysql中")]),v._v(" "),_("p",[v._v("针对作品的内容json内容数据，适合放在mongo中。")]),v._v(" "),_("h3",{attrs:{id:"数据表设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据表设计"}},[v._v("#")]),v._v(" 数据表设计")]),v._v(" "),_("p",[v._v("注意，使用sequelize 和 mongoose, 会自动创建id createAt， updateAt, 无需手动创建。")]),v._v(" "),_("p",[v._v("用户表：UserModel")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("列")]),v._v(" "),_("th",[v._v("类型")]),v._v(" "),_("th",[v._v("注释")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("username")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("用户名，唯一")])]),v._v(" "),_("tr",[_("td",[v._v("passward")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("密码保留字段")])]),v._v(" "),_("tr",[_("td",[v._v("phoneNumber")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("手机号")])]),v._v(" "),_("tr",[_("td",[v._v("nickname")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("昵称")])]),v._v(" "),_("tr",[_("td",[v._v("gender")]),v._v(" "),_("td",[v._v("int")]),v._v(" "),_("td",[v._v("性别 1男 2女 0 保密")])]),v._v(" "),_("tr",[_("td",[v._v("picture")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("头像")])]),v._v(" "),_("tr",[_("td",[v._v("latestLoginAt")]),v._v(" "),_("td",[v._v("date")]),v._v(" "),_("td",[v._v("最后登录时间")])]),v._v(" "),_("tr",[_("td",[v._v("isFrozen")]),v._v(" "),_("td",[v._v("boolean")]),v._v(" "),_("td",[v._v("用户是否冻结")])])])]),v._v(" "),_("p",[v._v("作品、模板：WorksModel")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("列")]),v._v(" "),_("th",[v._v("类型")]),v._v(" "),_("th",[v._v("注释")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("uuid")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("uuid h5url中使用 隐藏真正的id 避免被爬取")])]),v._v(" "),_("tr",[_("td",[v._v("title")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("标题")])]),v._v(" "),_("tr",[_("td",[v._v("desc")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("副标题")])]),v._v(" "),_("tr",[_("td",[v._v("contentId")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("未发布的内容id，内容存储在mongodb中")])]),v._v(" "),_("tr",[_("td",[v._v("publishContentId")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("发布的内容id，内容存储在mongodb中, 未发布的为空")])]),v._v(" "),_("tr",[_("td",[v._v("author")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("作者的username 和用户表关联")])]),v._v(" "),_("tr",[_("td",[v._v("isTemplate")]),v._v(" "),_("td",[v._v("boolean")]),v._v(" "),_("td",[v._v("是否是模板")])]),v._v(" "),_("tr",[_("td",[v._v("status")]),v._v(" "),_("td",[v._v("init")]),v._v(" "),_("td",[v._v("状态: 0-删除，1-未发布 2-发布 3-强制下线")])]),v._v(" "),_("tr",[_("td",[v._v("copiedCount")]),v._v(" "),_("td",[v._v("int")]),v._v(" "),_("td",[v._v("模板被使用的次数")])]),v._v(" "),_("tr",[_("td",[v._v("latestPublishAt")]),v._v(" "),_("td",[v._v("date")]),v._v(" "),_("td",[v._v("最近一次发布的时间")])]),v._v(" "),_("tr",[_("td",[v._v("isHot")]),v._v(" "),_("td",[v._v("boolean")]),v._v(" "),_("td",[v._v("hot标签 模板使用")])]),v._v(" "),_("tr",[_("td",[v._v("isNew")]),v._v(" "),_("td",[v._v("boolean")]),v._v(" "),_("td",[v._v("new标签，模板使用")])]),v._v(" "),_("tr",[_("td",[v._v("orderIndex")]),v._v(" "),_("td",[v._v("int")]),v._v(" "),_("td",[v._v("排序参数")])]),v._v(" "),_("tr",[_("td",[v._v("isPublic")]),v._v(" "),_("td",[v._v("boolean")]),v._v(" "),_("td",[v._v("模板是否公开展示")])])])]),v._v(" "),_("p",[v._v("渠道：ChannelModel")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("列")]),v._v(" "),_("th",[v._v("类型")]),v._v(" "),_("th",[v._v("注释")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("name")]),v._v(" "),_("td",[v._v("varchar")]),v._v(" "),_("td",[v._v("渠道名称")])]),v._v(" "),_("tr",[_("td",[v._v("workId")]),v._v(" "),_("td",[v._v("int")]),v._v(" "),_("td",[v._v("作品id")])]),v._v(" "),_("tr",[_("td",[v._v("status")]),v._v(" "),_("td",[v._v("int")]),v._v(" "),_("td",[v._v("状态: 0删除，1正常")])])])]),v._v(" "),_("p",[v._v("作品内容：mongodb")]),v._v(" "),_("div",{staticClass:"language-js line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-js"}},[_("code",[_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("{")]),v._v(" \n  "),_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 页面的组件列表")]),v._v("\n  "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v('"components:[Object]"')]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(",")]),v._v("\n  "),_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 页面的属性 如页面的背景图片")]),v._v("\n  "),_("span",{pre:!0,attrs:{class:"token literal-property property"}},[v._v("props")]),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v(":")]),v._v("Object"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(",")]),v._v("\n  "),_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 配置信息 如微信分享配置")]),v._v("\n  "),_("span",{pre:!0,attrs:{class:"token literal-property property"}},[v._v("setting")]),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v(":")]),v._v(" Object"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(",")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("}")]),v._v("\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br"),_("span",{staticClass:"line-number"},[v._v("2")]),_("br"),_("span",{staticClass:"line-number"},[v._v("3")]),_("br"),_("span",{staticClass:"line-number"},[v._v("4")]),_("br"),_("span",{staticClass:"line-number"},[v._v("5")]),_("br"),_("span",{staticClass:"line-number"},[v._v("6")]),_("br"),_("span",{staticClass:"line-number"},[v._v("7")]),_("br"),_("span",{staticClass:"line-number"},[v._v("8")]),_("br")])])])}),[],!1,null,null,null);_.default=r.exports}}]);