(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{421:function(s,a,t){"use strict";t.r(a);var e=t(14),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx打点服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx打点服务"}},[s._v("#")]),s._v(" nginx打点服务")]),s._v(" "),a("h2",{attrs:{id:"为何要拆分日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为何要拆分日志"}},[s._v("#")]),s._v(" 为何要拆分日志")]),s._v(" "),a("p",[s._v("access.log 日志默认不会拆分，会越积累越多，大文件不容易操作")]),s._v(" "),a("p",[s._v("离线分析日志，计算统计结果，一般是计算昨天的")]),s._v(" "),a("p",[s._v("试想这种场景下，从 access.log 一个大文件读取方便，还是拆分的零散文件方便。")]),s._v(" "),a("h2",{attrs:{id:"如何拆分日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何拆分日志"}},[s._v("#")]),s._v(" 如何拆分日志")]),s._v(" "),a("p",[s._v("根据流量情况，流量越大日志文件积累的越快，按照天、小时、分钟来拆分。\n例如：将 access.log 按照天拆分到某个文件夹中。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("logs_by_day/access.2022-0x-09log\nlogs_by_day/access.2022-0x-10.log\nlogs_by_day/access.2022-0x-11.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("拆分日志的技术实现")]),s._v(" "),a("ul",[a("li",[s._v("nginx依然是持续的写入access.log")]),s._v(" "),a("li",[s._v("启动定时任务，到凌晨00:00, 即将当前的 access.log 复制一份，并按照指定的日期命名。")]),s._v(" "),a("li",[s._v("将当前的access.log内容清空，这样nginx持续写入access.log，即新一天的日志。")])]),s._v(" "),a("h2",{attrs:{id:"定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[s._v("#")]),s._v(" 定时任务")]),s._v(" "),a("h3",{attrs:{id:"linux-crontab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-crontab"}},[s._v("#")]),s._v(" linux crontab")]),s._v(" "),a("ul",[a("li",[s._v("创建一个空的文件 a.txt")]),s._v(" "),a("li",[s._v("执行 crontab -e 编辑文件")]),s._v(" "),a("li",[s._v("加入一行 "),a("code",[s._v("* * * * * echo $(date) >> /User/cpff/a.txt")]),s._v(", 每分钟执行一次。")]),s._v(" "),a("li",[s._v("保存并退出")]),s._v(" "),a("li",[s._v("观察文件")])]),s._v(" "),a("h3",{attrs:{id:"nodejs-工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-工具"}},[s._v("#")]),s._v(" nodejs 工具")]),s._v(" "),a("p",[s._v("npm 插件 node-cron 或者使用 node-schedule")]),s._v(" "),a("ul",[a("li",[s._v("安装 cron 和 fs-extra")]),s._v(" "),a("li",[s._v("新建 demo/cron-demo.js 文件")]),s._v(" "),a("li",[s._v("运动该文件")])])])}),[],!1,null,null,null);a.default=n.exports}}]);