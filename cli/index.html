<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>脚手架 | 褚鹏飞的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="终于等到你">
    
    <link rel="preload" href="/assets/css/0.styles.7da46759.css" as="style"><link rel="preload" href="/assets/js/app.a11ed61a.js" as="script"><link rel="preload" href="/assets/js/2.68fcfb69.js" as="script"><link rel="preload" href="/assets/js/4.3dd36c4a.js" as="script"><link rel="prefetch" href="/assets/js/10.76535dc1.js"><link rel="prefetch" href="/assets/js/100.53c6da68.js"><link rel="prefetch" href="/assets/js/101.0a2cd5f7.js"><link rel="prefetch" href="/assets/js/102.e6d36811.js"><link rel="prefetch" href="/assets/js/103.be268cce.js"><link rel="prefetch" href="/assets/js/104.443e94a1.js"><link rel="prefetch" href="/assets/js/105.b2a3c7e4.js"><link rel="prefetch" href="/assets/js/106.841b5c2a.js"><link rel="prefetch" href="/assets/js/107.6deddf0b.js"><link rel="prefetch" href="/assets/js/108.4b9bfc1e.js"><link rel="prefetch" href="/assets/js/109.085ce327.js"><link rel="prefetch" href="/assets/js/11.01793e6c.js"><link rel="prefetch" href="/assets/js/110.6d4071eb.js"><link rel="prefetch" href="/assets/js/111.e629d0fb.js"><link rel="prefetch" href="/assets/js/112.7d7ebfac.js"><link rel="prefetch" href="/assets/js/113.f7a2bc10.js"><link rel="prefetch" href="/assets/js/114.df2b3f09.js"><link rel="prefetch" href="/assets/js/115.ea10a008.js"><link rel="prefetch" href="/assets/js/116.56ed59c7.js"><link rel="prefetch" href="/assets/js/117.9538695d.js"><link rel="prefetch" href="/assets/js/118.064de5ce.js"><link rel="prefetch" href="/assets/js/119.8c0bef2c.js"><link rel="prefetch" href="/assets/js/12.08f7cea2.js"><link rel="prefetch" href="/assets/js/120.422f483a.js"><link rel="prefetch" href="/assets/js/121.b36f9be0.js"><link rel="prefetch" href="/assets/js/122.697fa3bc.js"><link rel="prefetch" href="/assets/js/123.ea1dbdc9.js"><link rel="prefetch" href="/assets/js/124.3da1da74.js"><link rel="prefetch" href="/assets/js/125.9ee304ea.js"><link rel="prefetch" href="/assets/js/126.cb5ada3e.js"><link rel="prefetch" href="/assets/js/127.08df63e4.js"><link rel="prefetch" href="/assets/js/128.51302b27.js"><link rel="prefetch" href="/assets/js/129.b385db21.js"><link rel="prefetch" href="/assets/js/13.ca61de33.js"><link rel="prefetch" href="/assets/js/130.734ab146.js"><link rel="prefetch" href="/assets/js/131.3dba7356.js"><link rel="prefetch" href="/assets/js/132.42d69ee1.js"><link rel="prefetch" href="/assets/js/133.138235e7.js"><link rel="prefetch" href="/assets/js/134.1a3c5e63.js"><link rel="prefetch" href="/assets/js/135.4df167de.js"><link rel="prefetch" href="/assets/js/136.5a85082c.js"><link rel="prefetch" href="/assets/js/137.d0a0d6a8.js"><link rel="prefetch" href="/assets/js/138.d6d5bef2.js"><link rel="prefetch" href="/assets/js/139.3f9a2391.js"><link rel="prefetch" href="/assets/js/14.888fcebe.js"><link rel="prefetch" href="/assets/js/140.285a0546.js"><link rel="prefetch" href="/assets/js/141.53006afd.js"><link rel="prefetch" href="/assets/js/142.6317d60b.js"><link rel="prefetch" href="/assets/js/143.c65acb55.js"><link rel="prefetch" href="/assets/js/144.2d0b3bd1.js"><link rel="prefetch" href="/assets/js/145.648f6f1b.js"><link rel="prefetch" href="/assets/js/146.49a862d3.js"><link rel="prefetch" href="/assets/js/147.e2cf5d4f.js"><link rel="prefetch" href="/assets/js/148.e0240da1.js"><link rel="prefetch" href="/assets/js/149.461d0935.js"><link rel="prefetch" href="/assets/js/15.dee02ed7.js"><link rel="prefetch" href="/assets/js/150.dc7d8d07.js"><link rel="prefetch" href="/assets/js/151.44988a44.js"><link rel="prefetch" href="/assets/js/152.538916bd.js"><link rel="prefetch" href="/assets/js/153.550637d4.js"><link rel="prefetch" href="/assets/js/154.f7c98d94.js"><link rel="prefetch" href="/assets/js/155.79fd3740.js"><link rel="prefetch" href="/assets/js/156.c295bebc.js"><link rel="prefetch" href="/assets/js/157.95de245f.js"><link rel="prefetch" href="/assets/js/158.5f058215.js"><link rel="prefetch" href="/assets/js/159.b41c4125.js"><link rel="prefetch" href="/assets/js/16.84d36a6c.js"><link rel="prefetch" href="/assets/js/160.72db2cc1.js"><link rel="prefetch" href="/assets/js/161.339da306.js"><link rel="prefetch" href="/assets/js/162.f7b65681.js"><link rel="prefetch" href="/assets/js/163.af1dc00d.js"><link rel="prefetch" href="/assets/js/164.6d8a4fea.js"><link rel="prefetch" href="/assets/js/165.0db8728f.js"><link rel="prefetch" href="/assets/js/166.81ec7721.js"><link rel="prefetch" href="/assets/js/167.7d3b813a.js"><link rel="prefetch" href="/assets/js/168.417e912b.js"><link rel="prefetch" href="/assets/js/169.db53a386.js"><link rel="prefetch" href="/assets/js/17.8ae08a8e.js"><link rel="prefetch" href="/assets/js/170.8a6c637b.js"><link rel="prefetch" href="/assets/js/171.10cc930b.js"><link rel="prefetch" href="/assets/js/172.b9c2f00b.js"><link rel="prefetch" href="/assets/js/173.603b4b4c.js"><link rel="prefetch" href="/assets/js/174.0091f4cd.js"><link rel="prefetch" href="/assets/js/175.ca251970.js"><link rel="prefetch" href="/assets/js/176.4f9d27b6.js"><link rel="prefetch" href="/assets/js/177.dafe5de8.js"><link rel="prefetch" href="/assets/js/178.1a2e6049.js"><link rel="prefetch" href="/assets/js/179.5adf3f35.js"><link rel="prefetch" href="/assets/js/18.23fc6de7.js"><link rel="prefetch" href="/assets/js/180.17bed9e5.js"><link rel="prefetch" href="/assets/js/181.ece49b6d.js"><link rel="prefetch" href="/assets/js/182.b32808d0.js"><link rel="prefetch" href="/assets/js/183.9af51795.js"><link rel="prefetch" href="/assets/js/184.a302ebf4.js"><link rel="prefetch" href="/assets/js/185.09933572.js"><link rel="prefetch" href="/assets/js/186.b5c8f673.js"><link rel="prefetch" href="/assets/js/187.5c2cc4a4.js"><link rel="prefetch" href="/assets/js/188.19d8f889.js"><link rel="prefetch" href="/assets/js/189.f7500532.js"><link rel="prefetch" href="/assets/js/19.146b298e.js"><link rel="prefetch" href="/assets/js/190.7aa7a0fa.js"><link rel="prefetch" href="/assets/js/191.078d9e6b.js"><link rel="prefetch" href="/assets/js/192.6bbc1f77.js"><link rel="prefetch" href="/assets/js/193.3180a63b.js"><link rel="prefetch" href="/assets/js/194.70844ad2.js"><link rel="prefetch" href="/assets/js/195.9cd336a2.js"><link rel="prefetch" href="/assets/js/196.eab562bf.js"><link rel="prefetch" href="/assets/js/197.116a21c0.js"><link rel="prefetch" href="/assets/js/198.7daae84e.js"><link rel="prefetch" href="/assets/js/199.74f5339c.js"><link rel="prefetch" href="/assets/js/20.d7875c91.js"><link rel="prefetch" href="/assets/js/200.7bfcac74.js"><link rel="prefetch" href="/assets/js/201.e2395450.js"><link rel="prefetch" href="/assets/js/202.bd4cc82b.js"><link rel="prefetch" href="/assets/js/203.b24663c8.js"><link rel="prefetch" href="/assets/js/204.bc57826b.js"><link rel="prefetch" href="/assets/js/205.69ddfb9d.js"><link rel="prefetch" href="/assets/js/206.46645143.js"><link rel="prefetch" href="/assets/js/207.58c66003.js"><link rel="prefetch" href="/assets/js/208.b8d71a02.js"><link rel="prefetch" href="/assets/js/209.e9d6e9fd.js"><link rel="prefetch" href="/assets/js/21.0157fa1e.js"><link rel="prefetch" href="/assets/js/210.0cd23f53.js"><link rel="prefetch" href="/assets/js/211.48381c0b.js"><link rel="prefetch" href="/assets/js/212.b7f3c083.js"><link rel="prefetch" href="/assets/js/213.cf6d42ee.js"><link rel="prefetch" href="/assets/js/214.1ce66c8f.js"><link rel="prefetch" href="/assets/js/215.59db0939.js"><link rel="prefetch" href="/assets/js/216.797b94ce.js"><link rel="prefetch" href="/assets/js/217.dc6e74c7.js"><link rel="prefetch" href="/assets/js/218.711140d3.js"><link rel="prefetch" href="/assets/js/219.7683e3dd.js"><link rel="prefetch" href="/assets/js/22.73c85f89.js"><link rel="prefetch" href="/assets/js/220.117fa083.js"><link rel="prefetch" href="/assets/js/221.7b412896.js"><link rel="prefetch" href="/assets/js/222.a09845c3.js"><link rel="prefetch" href="/assets/js/223.6cee7cb4.js"><link rel="prefetch" href="/assets/js/224.d3ec2820.js"><link rel="prefetch" href="/assets/js/225.80e08084.js"><link rel="prefetch" href="/assets/js/226.d0ea6655.js"><link rel="prefetch" href="/assets/js/227.b7b2f645.js"><link rel="prefetch" href="/assets/js/228.e70e1104.js"><link rel="prefetch" href="/assets/js/229.76dc0b8e.js"><link rel="prefetch" href="/assets/js/23.c4ce5ef7.js"><link rel="prefetch" href="/assets/js/230.6ccfc77a.js"><link rel="prefetch" href="/assets/js/231.e3d1f123.js"><link rel="prefetch" href="/assets/js/232.a07b854d.js"><link rel="prefetch" href="/assets/js/233.b0657b46.js"><link rel="prefetch" href="/assets/js/234.40381110.js"><link rel="prefetch" href="/assets/js/235.98e0adf6.js"><link rel="prefetch" href="/assets/js/236.a7733e6c.js"><link rel="prefetch" href="/assets/js/237.b99530a9.js"><link rel="prefetch" href="/assets/js/238.52dc1e0e.js"><link rel="prefetch" href="/assets/js/239.31bf8adb.js"><link rel="prefetch" href="/assets/js/24.c551eddd.js"><link rel="prefetch" href="/assets/js/240.e769c475.js"><link rel="prefetch" href="/assets/js/241.18bf2442.js"><link rel="prefetch" href="/assets/js/242.686d7b7e.js"><link rel="prefetch" href="/assets/js/243.0b85d00f.js"><link rel="prefetch" href="/assets/js/244.10c13619.js"><link rel="prefetch" href="/assets/js/245.97a2374e.js"><link rel="prefetch" href="/assets/js/246.444e4691.js"><link rel="prefetch" href="/assets/js/247.b99e65fc.js"><link rel="prefetch" href="/assets/js/248.528193d9.js"><link rel="prefetch" href="/assets/js/249.b89ba49f.js"><link rel="prefetch" href="/assets/js/25.de9d8b90.js"><link rel="prefetch" href="/assets/js/250.29b49372.js"><link rel="prefetch" href="/assets/js/251.3150b875.js"><link rel="prefetch" href="/assets/js/252.476a4451.js"><link rel="prefetch" href="/assets/js/253.b9ab6d48.js"><link rel="prefetch" href="/assets/js/254.44120624.js"><link rel="prefetch" href="/assets/js/255.70f8ec81.js"><link rel="prefetch" href="/assets/js/256.efb2123b.js"><link rel="prefetch" href="/assets/js/257.860438b2.js"><link rel="prefetch" href="/assets/js/258.15bfdfab.js"><link rel="prefetch" href="/assets/js/259.a41eb2ac.js"><link rel="prefetch" href="/assets/js/26.e698578f.js"><link rel="prefetch" href="/assets/js/260.3003e870.js"><link rel="prefetch" href="/assets/js/261.0f05b4f6.js"><link rel="prefetch" href="/assets/js/262.f1dcdb68.js"><link rel="prefetch" href="/assets/js/263.7b112abf.js"><link rel="prefetch" href="/assets/js/264.abe8ddb1.js"><link rel="prefetch" href="/assets/js/265.f2a8bf8e.js"><link rel="prefetch" href="/assets/js/266.835d8eaa.js"><link rel="prefetch" href="/assets/js/267.54380cd6.js"><link rel="prefetch" href="/assets/js/268.81968375.js"><link rel="prefetch" href="/assets/js/269.864722b5.js"><link rel="prefetch" href="/assets/js/27.b322d650.js"><link rel="prefetch" href="/assets/js/270.154f4c92.js"><link rel="prefetch" href="/assets/js/271.fd33b750.js"><link rel="prefetch" href="/assets/js/272.ba820df9.js"><link rel="prefetch" href="/assets/js/273.860addb7.js"><link rel="prefetch" href="/assets/js/274.50e92144.js"><link rel="prefetch" href="/assets/js/275.745e898c.js"><link rel="prefetch" href="/assets/js/276.17a223c3.js"><link rel="prefetch" href="/assets/js/277.df899752.js"><link rel="prefetch" href="/assets/js/278.706f7124.js"><link rel="prefetch" href="/assets/js/279.defe3511.js"><link rel="prefetch" href="/assets/js/28.bf52892b.js"><link rel="prefetch" href="/assets/js/280.561a6e39.js"><link rel="prefetch" href="/assets/js/281.17241142.js"><link rel="prefetch" href="/assets/js/282.e944390a.js"><link rel="prefetch" href="/assets/js/283.3760e2d3.js"><link rel="prefetch" href="/assets/js/284.459eb22d.js"><link rel="prefetch" href="/assets/js/285.5aacd1a1.js"><link rel="prefetch" href="/assets/js/286.ef1acc1a.js"><link rel="prefetch" href="/assets/js/287.17cbd38f.js"><link rel="prefetch" href="/assets/js/288.d766b106.js"><link rel="prefetch" href="/assets/js/289.303246d3.js"><link rel="prefetch" href="/assets/js/29.c84a075b.js"><link rel="prefetch" href="/assets/js/290.c4d01af9.js"><link rel="prefetch" href="/assets/js/291.44959fa3.js"><link rel="prefetch" href="/assets/js/292.39fd7dde.js"><link rel="prefetch" href="/assets/js/293.82998912.js"><link rel="prefetch" href="/assets/js/294.9a850f2c.js"><link rel="prefetch" href="/assets/js/295.5cb2ab96.js"><link rel="prefetch" href="/assets/js/296.6708726c.js"><link rel="prefetch" href="/assets/js/297.9980f3a8.js"><link rel="prefetch" href="/assets/js/298.b94a7b87.js"><link rel="prefetch" href="/assets/js/299.25f38e79.js"><link rel="prefetch" href="/assets/js/3.c477c7c0.js"><link rel="prefetch" href="/assets/js/30.d2871a9c.js"><link rel="prefetch" href="/assets/js/300.8913b54b.js"><link rel="prefetch" href="/assets/js/301.0f683e6b.js"><link rel="prefetch" href="/assets/js/302.c8602a1c.js"><link rel="prefetch" href="/assets/js/303.7f52f776.js"><link rel="prefetch" href="/assets/js/304.4c8e4ec4.js"><link rel="prefetch" href="/assets/js/305.e96c98b7.js"><link rel="prefetch" href="/assets/js/306.5a9eb027.js"><link rel="prefetch" href="/assets/js/307.73f3170e.js"><link rel="prefetch" href="/assets/js/308.88995ed4.js"><link rel="prefetch" href="/assets/js/309.35edbb7e.js"><link rel="prefetch" href="/assets/js/31.1375278d.js"><link rel="prefetch" href="/assets/js/310.42a66e82.js"><link rel="prefetch" href="/assets/js/311.92f8cdcd.js"><link rel="prefetch" href="/assets/js/312.345d744e.js"><link rel="prefetch" href="/assets/js/313.acf572fc.js"><link rel="prefetch" href="/assets/js/314.ebf45408.js"><link rel="prefetch" href="/assets/js/315.b42eb4e7.js"><link rel="prefetch" href="/assets/js/316.93cb5051.js"><link rel="prefetch" href="/assets/js/317.91a5de53.js"><link rel="prefetch" href="/assets/js/318.62466402.js"><link rel="prefetch" href="/assets/js/319.d41c0049.js"><link rel="prefetch" href="/assets/js/32.f7051693.js"><link rel="prefetch" href="/assets/js/320.4a175589.js"><link rel="prefetch" href="/assets/js/321.554cc4a8.js"><link rel="prefetch" href="/assets/js/322.e45cc304.js"><link rel="prefetch" href="/assets/js/323.279a40fb.js"><link rel="prefetch" href="/assets/js/324.da8fb473.js"><link rel="prefetch" href="/assets/js/325.5ddb3232.js"><link rel="prefetch" href="/assets/js/326.c4322354.js"><link rel="prefetch" href="/assets/js/327.f9cc9bdd.js"><link rel="prefetch" href="/assets/js/328.eaa29fe2.js"><link rel="prefetch" href="/assets/js/329.63cd1487.js"><link rel="prefetch" href="/assets/js/33.3964a19e.js"><link rel="prefetch" href="/assets/js/330.debcd4dd.js"><link rel="prefetch" href="/assets/js/331.fc0f25c0.js"><link rel="prefetch" href="/assets/js/332.574bfab7.js"><link rel="prefetch" href="/assets/js/333.765a853b.js"><link rel="prefetch" href="/assets/js/334.8d427141.js"><link rel="prefetch" href="/assets/js/335.cd0fbeae.js"><link rel="prefetch" href="/assets/js/34.84a9c1c6.js"><link rel="prefetch" href="/assets/js/35.20e450d4.js"><link rel="prefetch" href="/assets/js/36.505aa3bf.js"><link rel="prefetch" href="/assets/js/37.5d4023c2.js"><link rel="prefetch" href="/assets/js/38.aef447f4.js"><link rel="prefetch" href="/assets/js/39.1604e093.js"><link rel="prefetch" href="/assets/js/40.931ca1c7.js"><link rel="prefetch" href="/assets/js/41.dd513f8f.js"><link rel="prefetch" href="/assets/js/42.58a79773.js"><link rel="prefetch" href="/assets/js/43.795c6159.js"><link rel="prefetch" href="/assets/js/44.04d841c5.js"><link rel="prefetch" href="/assets/js/45.720b2118.js"><link rel="prefetch" href="/assets/js/46.43f6f170.js"><link rel="prefetch" href="/assets/js/47.15a18d67.js"><link rel="prefetch" href="/assets/js/48.e674e423.js"><link rel="prefetch" href="/assets/js/49.45a171b5.js"><link rel="prefetch" href="/assets/js/5.a25af569.js"><link rel="prefetch" href="/assets/js/50.38de8ded.js"><link rel="prefetch" href="/assets/js/51.49304092.js"><link rel="prefetch" href="/assets/js/52.cfeebd88.js"><link rel="prefetch" href="/assets/js/53.d2d41f29.js"><link rel="prefetch" href="/assets/js/54.c0502a4a.js"><link rel="prefetch" href="/assets/js/55.f941632e.js"><link rel="prefetch" href="/assets/js/56.c328d292.js"><link rel="prefetch" href="/assets/js/57.6523d6d9.js"><link rel="prefetch" href="/assets/js/58.d6f3ab64.js"><link rel="prefetch" href="/assets/js/59.35826c49.js"><link rel="prefetch" href="/assets/js/6.286e5a09.js"><link rel="prefetch" href="/assets/js/60.ca3b3ee8.js"><link rel="prefetch" href="/assets/js/61.4db36e72.js"><link rel="prefetch" href="/assets/js/62.22f4c1f7.js"><link rel="prefetch" href="/assets/js/63.260de54e.js"><link rel="prefetch" href="/assets/js/64.bff002dd.js"><link rel="prefetch" href="/assets/js/65.041b60af.js"><link rel="prefetch" href="/assets/js/66.ad4ef726.js"><link rel="prefetch" href="/assets/js/67.48a2e70c.js"><link rel="prefetch" href="/assets/js/68.df01a75e.js"><link rel="prefetch" href="/assets/js/69.dbda1e68.js"><link rel="prefetch" href="/assets/js/7.ad7fe764.js"><link rel="prefetch" href="/assets/js/70.ef3abc27.js"><link rel="prefetch" href="/assets/js/71.c7b2aabf.js"><link rel="prefetch" href="/assets/js/72.79c8d05f.js"><link rel="prefetch" href="/assets/js/73.f547083a.js"><link rel="prefetch" href="/assets/js/74.8af7b9af.js"><link rel="prefetch" href="/assets/js/75.a5672242.js"><link rel="prefetch" href="/assets/js/76.c85af7a0.js"><link rel="prefetch" href="/assets/js/77.8f8c2634.js"><link rel="prefetch" href="/assets/js/78.a70dd1e1.js"><link rel="prefetch" href="/assets/js/79.626c4701.js"><link rel="prefetch" href="/assets/js/8.1552abcc.js"><link rel="prefetch" href="/assets/js/80.6b3f72fd.js"><link rel="prefetch" href="/assets/js/81.5b95790e.js"><link rel="prefetch" href="/assets/js/82.aad0e08d.js"><link rel="prefetch" href="/assets/js/83.5bf17836.js"><link rel="prefetch" href="/assets/js/84.4a561568.js"><link rel="prefetch" href="/assets/js/85.fcfae76b.js"><link rel="prefetch" href="/assets/js/86.07ee364f.js"><link rel="prefetch" href="/assets/js/87.03d43397.js"><link rel="prefetch" href="/assets/js/88.1db56f7d.js"><link rel="prefetch" href="/assets/js/89.ef3b9173.js"><link rel="prefetch" href="/assets/js/9.17e55863.js"><link rel="prefetch" href="/assets/js/90.bcde1774.js"><link rel="prefetch" href="/assets/js/91.14004b29.js"><link rel="prefetch" href="/assets/js/92.b81608a7.js"><link rel="prefetch" href="/assets/js/93.bf5615f6.js"><link rel="prefetch" href="/assets/js/94.28600765.js"><link rel="prefetch" href="/assets/js/95.79add1cf.js"><link rel="prefetch" href="/assets/js/96.ad1755b9.js"><link rel="prefetch" href="/assets/js/97.ac0f3a6a.js"><link rel="prefetch" href="/assets/js/98.300d3fa2.js"><link rel="prefetch" href="/assets/js/99.c2ea15c9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7da46759.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">褚鹏飞的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法学习" class="dropdown-title"><span class="title">算法学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法学习" class="mobile-dropdown-title"><span class="title">算法学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetCode/leetCode/" class="nav-link">
  LeetCode算法题解
</a></li><li class="dropdown-item"><!----> <a href="/leetCode/niuke/" class="nav-link">
  牛客算法题解
</a></li><li class="dropdown-item"><!----> <a href="/leetCode/valuableBook/" class="nav-link">
  面试题算法题解
</a></li><li class="dropdown-item"><!----> <a href="/leetCode/offer/" class="nav-link">
  剑指offer算法题解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue2-analysis/" class="nav-link">
  Vue2源码解析
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue3-analysis/" class="nav-link">
  Vue3源码解析
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-component/" class="nav-link">
  Vue组件探索
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex源码解析
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-router/" class="nav-link">
  Vue-Router源码解析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/React中的性能优化.html" class="nav-link">
  React中的性能优化
</a></li><li class="dropdown-item"><!----> <a href="/react/React中的useRef.html" class="nav-link">
  React中的useRef
</a></li><li class="dropdown-item"><!----> <a href="/react/React中的forwardRef.html" class="nav-link">
  React中的forwardRef
</a></li><li class="dropdown-item"><!----> <a href="/react/React中的useMemo.html" class="nav-link">
  React中的useMemo
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程化" class="dropdown-title"><span class="title">前端工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工程化" class="mobile-dropdown-title"><span class="title">前端工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/babel/" class="nav-link">
  Babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/webpack-base.html" class="nav-link">
  webpack基础
</a></li><li class="dropdown-item"><!----> <a href="/webpack/webpack-advance.html" class="nav-link">
  webpack进阶
</a></li><li class="dropdown-item"><!----> <a href="/rollup/" class="nav-link">
  Rollup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node.js" class="dropdown-title"><span class="title">Node.js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node.js" class="mobile-dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/node-base/" class="nav-link">
  Node基础
</a></li><li class="dropdown-item"><!----> <a href="/node/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/node/koa/" class="nav-link">
  Koa
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务端" class="dropdown-title"><span class="title">服务端</span> <span class="arrow down"></span></button> <button type="button" aria-label="服务端" class="mobile-dropdown-title"><span class="title">服务端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/nginx/nginx-base/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/threemusketeers/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/threemusketeers/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/threemusketeers/css/" class="nav-link">
  CSS
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法学习" class="dropdown-title"><span class="title">算法学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法学习" class="mobile-dropdown-title"><span class="title">算法学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetCode/leetCode/" class="nav-link">
  LeetCode算法题解
</a></li><li class="dropdown-item"><!----> <a href="/leetCode/niuke/" class="nav-link">
  牛客算法题解
</a></li><li class="dropdown-item"><!----> <a href="/leetCode/valuableBook/" class="nav-link">
  面试题算法题解
</a></li><li class="dropdown-item"><!----> <a href="/leetCode/offer/" class="nav-link">
  剑指offer算法题解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue2-analysis/" class="nav-link">
  Vue2源码解析
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue3-analysis/" class="nav-link">
  Vue3源码解析
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-component/" class="nav-link">
  Vue组件探索
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex源码解析
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-router/" class="nav-link">
  Vue-Router源码解析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/React中的性能优化.html" class="nav-link">
  React中的性能优化
</a></li><li class="dropdown-item"><!----> <a href="/react/React中的useRef.html" class="nav-link">
  React中的useRef
</a></li><li class="dropdown-item"><!----> <a href="/react/React中的forwardRef.html" class="nav-link">
  React中的forwardRef
</a></li><li class="dropdown-item"><!----> <a href="/react/React中的useMemo.html" class="nav-link">
  React中的useMemo
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程化" class="dropdown-title"><span class="title">前端工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工程化" class="mobile-dropdown-title"><span class="title">前端工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/babel/" class="nav-link">
  Babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/webpack-base.html" class="nav-link">
  webpack基础
</a></li><li class="dropdown-item"><!----> <a href="/webpack/webpack-advance.html" class="nav-link">
  webpack进阶
</a></li><li class="dropdown-item"><!----> <a href="/rollup/" class="nav-link">
  Rollup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node.js" class="dropdown-title"><span class="title">Node.js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node.js" class="mobile-dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/node-base/" class="nav-link">
  Node基础
</a></li><li class="dropdown-item"><!----> <a href="/node/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/node/koa/" class="nav-link">
  Koa
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务端" class="dropdown-title"><span class="title">服务端</span> <span class="arrow down"></span></button> <button type="button" aria-label="服务端" class="mobile-dropdown-title"><span class="title">服务端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/nginx/nginx-base/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/threemusketeers/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/threemusketeers/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/threemusketeers/css/" class="nav-link">
  CSS
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>脚手架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cli/#脚手架的搭建学习" class="sidebar-link">脚手架的搭建学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cli/#脚手架的核心价值" class="sidebar-link">脚手架的核心价值</a></li><li class="sidebar-sub-header"><a href="/cli/#脚手架的理解" class="sidebar-link">脚手架的理解</a></li><li class="sidebar-sub-header"><a href="/cli/#发布属于自己的第一个脚手架" class="sidebar-link">发布属于自己的第一个脚手架</a></li><li class="sidebar-sub-header"><a href="/cli/#脚手架的本地调试方法" class="sidebar-link">脚手架的本地调试方法</a></li><li class="sidebar-sub-header"><a href="/cli/#分包联合调试" class="sidebar-link">分包联合调试</a></li><li class="sidebar-sub-header"><a href="/cli/#深入理解-npm-link-命令" class="sidebar-link">深入理解 npm link 命令</a></li><li class="sidebar-sub-header"><a href="/cli/#总结一下脚手架本地link标准流程" class="sidebar-link">总结一下脚手架本地link标准流程</a></li><li class="sidebar-sub-header"><a href="/cli/#总结一下如何解除本地链接" class="sidebar-link">总结一下如何解除本地链接</a></li><li class="sidebar-sub-header"><a href="/cli/#如何解除本地链接呢" class="sidebar-link">如何解除本地链接呢？</a></li><li class="sidebar-sub-header"><a href="/cli/#使用原生的方式获取命令行参数" class="sidebar-link">使用原生的方式获取命令行参数</a></li><li class="sidebar-sub-header"><a href="/cli/#发布脚手架的时候需要注意的事项" class="sidebar-link">发布脚手架的时候需要注意的事项</a></li></ul></li><li><a href="/cli/#使用-lerna" class="sidebar-link">使用 lerna</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cli/#lerna-解决了什么痛点" class="sidebar-link">lerna 解决了什么痛点</a></li><li class="sidebar-sub-header"><a href="/cli/#脚手架项目初始化" class="sidebar-link">脚手架项目初始化</a></li><li class="sidebar-sub-header"><a href="/cli/#创建package" class="sidebar-link">创建package</a></li><li class="sidebar-sub-header"><a href="/cli/#脚手架的开发和测试" class="sidebar-link">脚手架的开发和测试</a></li><li class="sidebar-sub-header"><a href="/cli/#脚手架发布上线" class="sidebar-link">脚手架发布上线</a></li></ul></li><li><a href="/cli/#lerna源码阅读" class="sidebar-link">lerna源码阅读</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cli/#核心开发" class="sidebar-link">核心开发</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cli/#模块拆分" class="sidebar-link">模块拆分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cli/#core-模块拆分" class="sidebar-link">core 模块拆分</a></li><li class="sidebar-sub-header"><a href="/cli/#开发检查版本号的功能" class="sidebar-link">开发检查版本号的功能</a></li><li class="sidebar-sub-header"><a href="/cli/#封装-npmlog-方法" class="sidebar-link">封装 npmlog 方法</a></li><li class="sidebar-sub-header"><a href="/cli/#封装检查node版本的方法" class="sidebar-link">封装检查node版本的方法</a></li><li class="sidebar-sub-header"><a href="/cli/#检查root启动" class="sidebar-link">检查root启动</a></li><li class="sidebar-sub-header"><a href="/cli/#检查用户主目录" class="sidebar-link">检查用户主目录</a></li><li class="sidebar-sub-header"><a href="/cli/#处理一些参数问题" class="sidebar-link">处理一些参数问题</a></li><li class="sidebar-sub-header"><a href="/cli/#检查环境变量" class="sidebar-link">检查环境变量</a></li><li class="sidebar-sub-header"><a href="/cli/#检查是否为最新版本" class="sidebar-link">检查是否为最新版本</a></li></ul></li><li><a href="/cli/#注册命令逻辑" class="sidebar-link">注册命令逻辑</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="脚手架"><a href="#脚手架" class="header-anchor">#</a> 脚手架</h1> <h2 id="脚手架的搭建学习"><a href="#脚手架的搭建学习" class="header-anchor">#</a> 脚手架的搭建学习</h2> <h3 id="脚手架的核心价值"><a href="#脚手架的核心价值" class="header-anchor">#</a> 脚手架的核心价值</h3> <ul><li>自动化：项目重复代码拷贝/git操作/发布上线操作</li> <li>标准化：项目创建/git flow/发布流程/回滚流程</li> <li>数据化：研发过程系统化、数据化，使得研发过程可以量化</li></ul> <h3 id="脚手架的理解"><a href="#脚手架的理解" class="header-anchor">#</a> 脚手架的理解</h3> <p>脚手架本质是一个操作系统的客户端，它通过命令行执行，比如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue create vue-test-app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面这条命令由3个部分组成:</p> <ul><li>主命令：vue</li> <li>command：create</li> <li>command 的 params：vue-test-app</li></ul> <p>它表示创建一个vue项目，项目的名称 为 vue-test-app，以上是一个比较简单的脚手架命令。</p> <p>实际场景中可能比较复杂，比如当前目录已经存在了，我们需要覆盖当前目录下文件，强制进行安装vue项目。</p> <p><img src="/assets/img/02.a773ab81.png" alt="脚手架运行原理"></p> <ul><li>当我们在终端中输入vue后，会在环境变量中找到vue指令，which vue(在mac中，可以输入which vue 查看某些命令是否存在)。
我在本机中输入 which vue 输出vue这个命令的指令所在的目录。</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">which</span> vue
/usr/local/bin/vue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>根据输出的信息，我进入 /usr/local/bin 目录。执行<code>ll</code>命令，查看vue命令的软链，因为我是通过yarn全局安装的vue脚手架。所以链接指向的是yarn的目录。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/Users/louis/.config/yarn/global/node_modules/.bin/vue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>进入软链接所对应的文件夹，查看vue命令最终的指向</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>lrwxr-xr-x  <span class="token number">1</span> louis  staff    22B  <span class="token number">3</span> <span class="token number">30</span> <span class="token number">21</span>:12 vue -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/@vue/cli/bin/vue.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从上面路径可以看出，最终的vue指向 node_modules/@vue 文件夹。也就是安装的vue脚手架核心代码所在的地方</p> <p>让我们总结一下：</p> <ul><li>终端中输入 vue create vue-test-app</li> <li>终端中解析出vue命令</li> <li>终端在<strong>环境变量</strong>中找到vue命令</li> <li>终端根据vue命令链接到实际文件vue.js</li> <li>终端利用node执行vue.js</li> <li>vue.js解析 command / options</li> <li>vue.js 执行 command</li> <li>执行完毕，退出执行</li></ul> <h3 id="发布属于自己的第一个脚手架"><a href="#发布属于自己的第一个脚手架" class="header-anchor">#</a> 发布属于自己的第一个脚手架</h3> <p>第一步：我们需要创建一个npm的项目，在终端执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在工作目录会生成一个<code>package.json</code>文件</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zf-process-cli&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;zf-process-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chupengfei &lt;chupengfeiit@gmail.com&gt; (https://github.com/MagicalBridge)&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>第二步：在根目录下创建一个bin目录，并创建一个<code>index.js</code>.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>├── bin
│   └── index.js
└── package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第三步：先登录 npm 官网，如果自己使用nrm管理 npm 源的时候，不要忘记了切换到npm官方源。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>nrm use <span class="token function">npm</span> // 切换到官方源进行处理
<span class="token function">npm</span> login 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>按照要求填写用户名、密码、邮箱。</p> <p>第四步：执行 <code>npm publish</code> (这一步需要注意，可能会因为发布过相同的版本而没有办法发布成功，注意修改版本。)</p> <h3 id="脚手架的本地调试方法"><a href="#脚手架的本地调试方法" class="header-anchor">#</a> 脚手架的本地调试方法</h3> <ul><li>第一步: 进入到脚手架所在的目录，执行<code>npm link</code>。</li></ul> <p>具体的场景, 我本地创建一个脚手架项目, 但是还没有发布到线上，不能执行 <code>npm install -g zf-process-cli</code> 这种形式进行安装。又想要调试脚手架，此时就可以在脚手架目录下执行执行<code>npm link</code>。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>zf-process-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> <span class="token function">npm</span> <span class="token function">link</span>

added <span class="token number">1</span> package, and audited <span class="token number">3</span> packages <span class="token keyword">in</span> 1s

found <span class="token number">0</span> vulnerabilities
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>第二步：如何确定脚手架本地已经链接成功？</li></ul> <p>此时使用 <code>which zf-process-cli</code> 查看当前脚手架的可执行命令，通过输出的执行结果可以看到，<code>zf-process-cli</code>这个命令已经被连接到了全局的<code>node_module</code>的<code>bin</code>目录下。如果显示已经连接到全局的node_module的bin目录下，说明已经连接成功，此时在终端中执行 脚手架的命令，就能启动脚手架。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>zf-process-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ <span class="token function">which</span> zf-process-cli
/Users/louis/.nvm/versions/node/v14.16.0/bin/zf-process-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>事实上，我们在全局安装的所有的node_modules包都会默认放在这个目录下面</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>zf-process-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ <span class="token function">which</span> <span class="token function">npm</span>
/Users/louis/.nvm/versions/node/v14.16.0/bin/npm

zf-process-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ <span class="token function">which</span> <span class="token function">yarn</span>
/Users/louis/.nvm/versions/node/v14.16.0/bin/yarn
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>第三步：我们修改脚手架中的代码，此时执行脚手架命令，会运行新的代码。</p></li> <li><p>第四步：如何移除本地的链接？</p></li></ul> <p>我曾经尝试过使用<code>npm unlink zf-process-cli</code> 并没有成功。真实生效的命令是执行</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> uninstall <span class="token parameter variable">-g</span> zf-process-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样就从全局的 <code>node_modules</code> 的<code>bin</code>目录下将脚手架移除了。</p> <p>我们进入本地全局<code>node_modules</code>的下面<code>bin</code>目录执行如下操作。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin git:<span class="token punctuation">(</span>f355b32<span class="token punctuation">)</span> ✗ ll zf-process-cli
lrwxr-xr-x <span class="token number">1</span> louis staff 47B <span class="token number">8</span> <span class="token number">30</span> 07:52 zf-process-cli -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/lib/node_modules/zf-process-cli/bin/index.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>实际上执行link之后，生成了一个软连接，<code>bin/zf-process-cli</code> 指向的是 <code>../lib/node_modules/zf-process-cli/bin/index.js</code> 这个包的入口文件，这个是我们在package.json中配置的规则。</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zf-process-cli&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;zf-process-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chupengfei &lt;chupengfeiit@gmail.com&gt; (https://github.com/MagicalBridge)&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="分包联合调试"><a href="#分包联合调试" class="header-anchor">#</a> 分包联合调试</h3> <p>在实际开发过程中，由于脚手架功能较多，不可能将所有的内容都写在一个包之中，需要将脚手架进行分包处理。这就是涉及到分包的联合调试。</p> <p>文件目录结构如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># zf-process-cli
.
├── core // 核心模块
│   ├── bin
│   │   └── index.js
│   └── package.json
└── lib // lib 工具模块
    ├── package.json
    └── src
        └── index.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>我们的需求是在<code>lib</code>包还没有发布到线上的时候，就能够进行调试，这个应该如何操作呢？</p> <ul><li>第一步：在lib包中执行 <code>npm link</code> 变成全局模块。</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># lib 目录下 </span>
<span class="token function">npm</span> <span class="token function">link</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>因为lib是一个库文件，且没有配置bin入口，因此执行完之后，再执行 which lib 是找不到的。但是在node_modules 中是能够找到lib 这个文件的。</p> <ul><li>第二步：进入 core 目录 执行 <code>npm link lib</code></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># core 目录下 这里需要注意下，执行这个命令的前提其实是 lib已经链接到全局</span>
<span class="token function">npm</span> <span class="token function">link</span> lib
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样就能在core目录下添加一个node_modules文件夹，里面存放的就是lib目录。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># zf-process-cli
.
├── core
│   ├── bin
│   │   └── index.js
│   ├── node_modules
│   │   └── lib -&gt; ../../lib
│   └── package.json
└── lib
    ├── package.json
    └── src
        └── index.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>第三步: 在core中引入 lib 模块的函数,可以使用。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// core/bin/index.js</span>
#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token keyword">const</span> lib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;lib&quot;</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lib<span class="token punctuation">.</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;welcome process-cli&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>还有一点比较重要，因为core文件的package.json文件中依赖中并没有写上lib，这样在真实发布线上的时候会出现问题。因此需要添加依赖信息。</p> <h3 id="深入理解-npm-link-命令"><a href="#深入理解-npm-link-命令" class="header-anchor">#</a> 深入理解 npm link 命令</h3> <p>经过上述两个简单的用例可以看出来，无论是单一文件发布成脚手架，还是多包状态下调试，都离不开一个命令<code>npm link</code>。</p> <ul><li><code>npm link you-lib</code>: 将当前项目中node_modules下指定的库文件链接到 node 全局下 node_module下的库文件</li> <li><code>npm link</code>: 将当前项目链接到 node 全局 node_modules中作为一个库文件，并解析 bin 配置创建可执行的文件</li></ul> <h3 id="总结一下脚手架本地link标准流程"><a href="#总结一下脚手架本地link标准流程" class="header-anchor">#</a> 总结一下脚手架本地link标准流程</h3> <ul><li>因为本地的脚手架还没有发布上线，但是想要实现和发布后的脚手架的使用效果，首先在本地执行</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> <span class="token function">link</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行上述操作之后，就可以像使用vue脚手架那样使用这个自己的脚手架了，而且更改了代码还能实时更新。</p> <ul><li>由于分包处理的原因，有时候脚手架需要链接本地的lib库</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> your-lib-dir
<span class="token function">npm</span> <span class="token function">link</span> <span class="token comment"># 将本地的lib库链接为全局的库</span>

<span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> <span class="token function">link</span> your-lib <span class="token comment"># 进入脚手架目录，link lib库</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="总结一下如何解除本地链接"><a href="#总结一下如何解除本地链接" class="header-anchor">#</a> 总结一下如何解除本地链接</h3> <ul><li>首先进入本地的lib库 解除本地链接</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> your-lib-dir
<span class="token function">npm</span> unlink
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>进入cli目录 解除链接</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> your-cli-dir
<span class="token comment"># link 存在</span>
<span class="token function">npm</span> unlink your-lib 
<span class="token comment"># link 不存在</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules
<span class="token function">npm</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="如何解除本地链接呢"><a href="#如何解除本地链接呢" class="header-anchor">#</a> 如何解除本地链接呢？</h3> <p>解除的步骤和链接的步骤是相反的。</p> <ul><li>第一步: 在core目录中执行<code>npm unlink lib</code> 这个步骤执行完毕后lib从core的依赖中解除。</li> <li>第二步: 删除node_modules依赖，删除 package.lock 文件。</li> <li>第三步: lib link到全局之后 执行 <code>npm remove -g lib</code> 删除依赖包，然后删除 package.lock 文件。</li></ul> <h3 id="使用原生的方式获取命令行参数"><a href="#使用原生的方式获取命令行参数" class="header-anchor">#</a> 使用原生的方式获取命令行参数</h3> <p>这里需要借助原生的process模块进行实现。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>zf-process-cli init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上述命令执行之后，我们在core/index.js中打印出来：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面的代码中返回的是一个数组，数组的第一个元素是node的安装环境，第二个参数代表的是当前执行命令的目录，后面的参数就是我们执行命令附带的参数。一般来说，我们只需要数组的第三项之后的内容。</p> <h3 id="发布脚手架的时候需要注意的事项"><a href="#发布脚手架的时候需要注意的事项" class="header-anchor">#</a> 发布脚手架的时候需要注意的事项</h3> <p>这里需要注意两点：</p> <ul><li>1、将本地的link关系解除，这样，在发布之后安装的就是线上的版本。</li> <li>2、注意版本号的升级，如果不升级版本号。是发布不上去的。</li></ul> <h2 id="使用-lerna"><a href="#使用-lerna" class="header-anchor">#</a> 使用 lerna</h2> <p>lerna是一款基于<code>git npm</code>非常优秀的多包管理工具，上面我们手动创建的包可以很方便的交给工具。</p> <p>它有诸多优势，能够大幅减少重复操作，提升操作的标准化，lerna是架构优化的产物，它揭示了一个架构的真理：</p> <blockquote><p>项目复杂度提升之后，就需要对项目进行架构优化，架构优化的主要目的往往都是以效能为核心。</p></blockquote> <p>我们常见的优秀的开源项目 babel、vue-cli 等都是基于 lerna 来管理的。</p> <h3 id="lerna-解决了什么痛点"><a href="#lerna-解决了什么痛点" class="header-anchor">#</a> lerna 解决了什么痛点</h3> <ul><li>重复操作：
<ul><li>多package 本地 link</li> <li>多package 依赖安装</li> <li>多package 单元测试</li> <li>多package 代码提交</li> <li>多package 代码发布</li></ul></li> <li>版本一致性
<ul><li>发布时候版本一致性: 一个包被另外多个包引用作为依赖，如果你想要升级依赖，不借助leran工具，那将会是非常痛苦的事情。</li> <li>发布后相互依赖版本升级</li></ul></li></ul> <h3 id="脚手架项目初始化"><a href="#脚手架项目初始化" class="header-anchor">#</a> 脚手架项目初始化</h3> <ul><li>1 使用 npm init -y 初始化一个npm 项目。</li> <li>2 在本地全局安装lerna, 这样方便使用。</li> <li>3 执行 <code>lerna init</code> 初始化lerna项目。</li> <li>4 这里需要注意，使用lerna 创建的项目会自动初始化一个git。</li> <li>5 创建 .gitignore 文件，用于忽略文件</li></ul> <p><img src="/assets/img/03.49ddf72d.png" alt="脚手架的初始化"></p> <p>lerna init 操作执行之后，会在项目中生成一个 <code>lerna.json</code> 的文件,并且会生成一个packages文件夹。修改一个自己喜欢的版本号。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;packages/*&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这两个属性中packages代表之后的安装的包存放的位置。结合pnpm的配置文件，这里加深理解。</p> <h3 id="创建package"><a href="#创建package" class="header-anchor">#</a> 创建package</h3> <p><img src="/assets/img/04.e201f64f.png" alt="创建package"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>lerna create &lt;name&gt; [loc] 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这是创建包的命令，指定包名<code>&lt;name&gt;</code>（使用尖括号包裹的内容都是必须填写的），<code>[loc]</code> 方括号包裹起来的内容是可以不写的，用来手动指定路径。</p> <ul><li>1、执行<code>lerna create core</code>创建一个叫做core的包，这里的core显示的是文件夹的名称，需要注意的是，我们需要<strong>新建组</strong>，新建组后在组里面创建子包，否则直接注册子包大概率已经被注册过了。如下图所示，第二行，我们创建的包是在 @zf-mock-cli 这个组下面。</li></ul> <p>发布之前，需要在npm的官方网站中注册一个组信息，否则包是上传不上去的。</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@zf-mock-cli/core&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt; TODO: description&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;褚鹏飞 &lt;540788769@qq.com&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;homepage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/MagicalBridge/architect-all-in-one#readme&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/core.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;directories&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__tests__&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;lib&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://registry.npm.taobao.org/&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git+https://github.com/MagicalBridge/architect-all-in-one.git&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: run tests from root\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bugs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/MagicalBridge/architect-all-in-one/issues&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>2、执行lerna create utils 创建一个工具包。工具包也放在 @zf-mock-cli 组下面。</li></ul> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@zf-mock-cli/utils&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt; TODO: description&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;褚鹏飞 &lt;540788769@qq.com&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;homepage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/MagicalBridge/architect-all-in-one#readme&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/utils.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;directories&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__tests__&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;lib&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://registry.npm.taobao.org/&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git+https://github.com/MagicalBridge/architect-all-in-one.git&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: run tests from root\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bugs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/MagicalBridge/architect-all-in-one/issues&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>3、使用lerna add 安装依赖</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna <span class="token function">add</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span> <span class="token punctuation">[</span>@version<span class="token punctuation">]</span> <span class="token punctuation">[</span>--dev<span class="token punctuation">]</span> <span class="token punctuation">[</span>--exact<span class="token punctuation">]</span> <span class="token punctuation">[</span>--peer<span class="token punctuation">]</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从上面的命令我们可以看到 package 必须要填写，版本信息可以不选。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意，如果我们直接执行 lerna add xxx 默认 lerna 会将package 安装到所有的包中</p></div> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>➜  zf-mock-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ lerna <span class="token function">add</span> mime
lerna notice cli v4.0.0
lerna info Adding mime <span class="token keyword">in</span> <span class="token number">2</span> packages
lerna info Bootstrapping <span class="token number">2</span> packages
lerna info Installing external dependencies
lerna info Symlinking packages and binaries
lerna success Bootstrapped <span class="token number">2</span> packages
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>从上面的安装信息可以看到，默认 lerna 将mime 模块安装到了 utils 和 core 两个包中。</p> <p>如果我们想要安装到指定目录下应该如何操作呢？只需要跟上一个具体的路径就好.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna <span class="token function">add</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span> packages/utis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>具体操作效果：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>➜  zf-mock-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ lerna <span class="token function">add</span> mime packages/utils 
lerna notice cli v4.0.0
lerna info Adding mime <span class="token keyword">in</span> <span class="token number">1</span> package
lerna info Bootstrapping <span class="token number">2</span> packages
lerna info Installing external dependencies
lerna info Symlinking packages and binaries
lerna success Bootstrapped <span class="token number">2</span> packages
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>4 使用lerna clean 删除node_modules</li></ul> <p>使用场景，安装依赖的时候，如果不指定安装到哪一个目录，默认会给所有目录都安装上指定的依赖。</p> <p>当我们想要把 packages 下面的所有包的node_modules都删除的时候，可以使用这个命令。</p> <p>需要注意的是，虽然我们把node_modules删除了，但是package.json 中的依赖并没有删除。在特定场景下需要手动进行删除。</p> <ul><li>5 使用lerna bootstrap 重新安装依赖</li></ul> <p>使用场景：在使用 lerna clean 删除的依赖，使用bootstrap，就能全部安装回来</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna bootstrap
lerna notice cli v4.0.0
lerna info Bootstrapping <span class="token number">2</span> packages
lerna info Installing external dependencies
lerna info Symlinking packages and binaries
lerna success Bootstrapped <span class="token number">2</span> packages
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>6 learn link 链接依赖</li></ul> <p>如果我们创建的package中有互相的依赖,  <code>learn link</code> 可以帮助我们创建软链接。我们直接在项目中直接执行 <code>lerna link</code> 是没有多少效果的。我们必须在需要链接的模块下，手动添加依赖的名称和版本，然后执行 <code>lerna link</code> 这样才有效果。</p> <p>具体的场景就是，我想要在core包中使用 utils 这个包，手动在core的package.json中添加依赖urils的名称和版本。然后手动执行 <code>lerna link</code> 就能够链接成功。</p> <p>如果没有这个操作，我们使用npm提供的原生的功能，就必须进入core目录下手动执行 <code>npm link xxx</code> ,如果项目复杂，存在非常复杂的依赖，这种关系我们自己维护是非常痛苦的。</p> <h3 id="脚手架的开发和测试"><a href="#脚手架的开发和测试" class="header-anchor">#</a> 脚手架的开发和测试</h3> <p><img src="/assets/img/05.794483bc.png" alt="脚手架的开发和测试"></p> <ul><li>1、lerna exec 执行 shell 脚本</li></ul> <p>在每个包下面执行脚本命令，需要在具体的命令前加上 <code>--</code> :</p> <p>我们在上面的操作中使用</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 删除所有package 里面的 node_modules 依赖</span>
lerna <span class="token builtin class-name">exec</span> -- <span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules

<span class="token comment"># 执行命令之后的效果</span>
➜  zf-mock-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ lerna <span class="token builtin class-name">exec</span> -- <span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules
lerna notice cli v4.0.0
lerna info Executing <span class="token builtin class-name">command</span> <span class="token keyword">in</span> <span class="token number">2</span> packages: <span class="token string">&quot;rm -rf node_modules&quot;</span>
lerna success <span class="token builtin class-name">exec</span> Executed <span class="token builtin class-name">command</span> <span class="token keyword">in</span> <span class="token number">2</span> packages: <span class="token string">&quot;rm -rf node_modules&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>执行这个命令是在packages这个目录下面，而不是在根目录下面，这点需要特别注意。</p></div> <p>如果我们想要在指定目录下面执行脚本，需要添加 <code>--scope</code> 后缀</p> <p>比如，我们只想要删除<code>utils</code>下面的<code>node_modules</code>可以执行下面的命令</p> <p>这里需要注意的是，删除需要 <strong>指定包名称</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 只删除 utils 下面的 node_modules</span>
lerna <span class="token builtin class-name">exec</span> <span class="token parameter variable">--scope</span> @zf-mock-cli/util <span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules

<span class="token comment"># 执行效果</span>
➜  zf-mock-cli git:<span class="token punctuation">(</span>main<span class="token punctuation">)</span> ✗ lerna <span class="token builtin class-name">exec</span> <span class="token parameter variable">--scope</span> @zf-mock-cli/utils -- <span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules
lerna notice cli v4.0.0
lerna notice filter including <span class="token string">&quot;@zf-mock-cli/utils&quot;</span>
lerna info filter <span class="token punctuation">[</span> <span class="token string">'@zf-mock-cli/utils'</span> <span class="token punctuation">]</span>
lerna info Executing <span class="token builtin class-name">command</span> <span class="token keyword">in</span> <span class="token number">1</span> package: <span class="token string">&quot;rm -rf node_modules&quot;</span>
lerna success <span class="token builtin class-name">exec</span> Executed <span class="token builtin class-name">command</span> <span class="token keyword">in</span> <span class="token number">1</span> package: <span class="token string">&quot;rm -rf node_modules&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>2、lerna run 执行 npm 命令</li></ul> <p>这个命令主要是执行 npm 的script 脚本，默认行情况下，会执行所有的包下面的 package.json 下面的脚本信息。 同样这个命令也支持 --scope 选项。</p> <p>这个命令的执行 也是作用在packages里面的命令</p> <ul><li>3、lerna clean 清空依赖</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna clean 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行上述命令之后，会删除node_module 信息，但是package.json 里面的内容不会被删除。这点需要注意</p> <ul><li>4、lerna bootstrap 重新安装依赖</li></ul> <h3 id="脚手架发布上线"><a href="#脚手架发布上线" class="header-anchor">#</a> 脚手架发布上线</h3> <p><img src="/assets/img/06.82e0dcc4.png" alt="脚手架的发布上线"></p> <p>脚手架的发布上线，一般需要升级版本号，这种都属于常规操作。</p> <ul><li>1、lerna version bump version</li> <li>2、lerna changed 查看上一个版本以来的所有变更</li></ul> <p>使用场景：我分别修改了 core 和 utils 两个包中的代码，在执行这个命令的时候打印两个包内容需要发布。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>➜  cdp-wpm-cli git:(master) ✗ lerna changed 
info cli using local version of lerna
lerna notice cli v4.0.0
lerna info Assuming all packages changed
@cdp-wpm/core
@cdp-wpm/utils
lerna success found 2 packages ready to publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>3、lerna diff 查看diff
查看修改了哪些代码内容。</p></li> <li><p>4、lerna publish 项目发布
发布过程中是非常坎坷的，对于组npm包而言，不仅仅是登录问题，还需要在package.json文件中添加如下字段：</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>只有添加了这个配置的文件才能发布上去。</p> <p>还需要注意的点是，每当执行一次提交，都会在分支上打上tag。重复打tag会报错。</p> <h2 id="lerna源码阅读"><a href="#lerna源码阅读" class="header-anchor">#</a> lerna源码阅读</h2> <p>首先需要掌握源码调试的技巧。</p> <ul><li><p>1 入口文件在core目录下的lerna文件夹中</p></li> <li><p>2 通过 core/lerna/package.json 中的bin字段可以看出来，真正的入口文件其实是 cli.js</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/* eslint-disable import/no-dynamic-require, global-require */</span>
<span class="token keyword">const</span> importLocal <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;import-local&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">importLocal</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;npmlog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;cli&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;using local version of lerna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上面代码中的 <code>require(&quot;.&quot;)</code> 其实是一种简写，点是相对路径的表示，默认会加载index.js</p> <p><a href="/cli/import-local.html">import-local</a></p> <ul><li>3 在阅读lerna的源码的时候，会看到在依赖列表中看到了 <code>file:xxx</code> 这种形式。这种方法是非常值得借鉴的。</li></ul> <p>这种方法可以应用到我们当前编写的脚手架中。</p> <p>使用场景：目前我们的脚手架中 只有 core 和 utils 两个包，我想在 core 中引用utils包。</p> <p>首先在core的package.json中添加如下代码, 使用file这种写法，将uitls依赖进来</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;@cdp-wpm/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file:../utils&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;koa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.13.4&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后在core目录下执行 <code>npm install</code>,  生成软链接，这样在core包中使用require语法加载 utils包之后，就能正常使用了。</p> <p>core/bin/index.js 代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#! /usr/bin/env node </span>

<span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@cdp-wpm/utils&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 执行utils</span>
<span class="token function">utils</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello cdp-wpm-cli&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="核心开发"><a href="#核心开发" class="header-anchor">#</a> 核心开发</h2> <p>在学习lerna源码的时候，学习到了一个比较有意思的模块 <code>import-local</code>。</p> <p>简单来说，使用 <code>import-local</code> 可以让全局安装的包使用你自己项目中自己的版本。意思是假设你在电脑中全局安装了webpack4，但是项目中使用的是webpack5，当你在项目中使用webpack命令的时候，他会优先使用webpack5版本，当然这个前提是你的node_modules已经安装了webpack。</p> <p>import-local常常在cli工具中使用，可以方便cli工具开发（可以参考lerna）。使用方式如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> importlocal <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;import-local&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">importlocal</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;npmlog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;cli&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;using local version of lerna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>看上面的代码，传入当前文件的执行路径，满足条件执行对应的逻辑即可。</p> <p>import-local 执行时候通过传入 <code>__filename</code> 作为运行参数执行, <code>__filename</code>在node中为当前模块的文件名。这是当前模块文件的已经解析符号链接的<strong>绝对路径</strong>。</p> <p>例如 从 <code>/Users/mjr</code> 运行 <code>node example.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印: /Users/mjr/example.js</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a href="https://juejin.cn/post/7015813508814077989" target="_blank" rel="noopener noreferrer">参考文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="模块拆分"><a href="#模块拆分" class="header-anchor">#</a> 模块拆分</h2> <p>首先根据功能点拆分成几个模块：</p> <ul><li>核心模块 core</li> <li>命令模块 commands</li> <li>模型模块 models</li> <li>工具模块 utils</li></ul> <p>上面几个模块就是我们的拆包的策略，将功能模块拆分之后，维护起来会更加的清晰。</p> <p>首先在脚手架的 目录中创建这几个文件夹：commands、core、models、utils</p> <p>并且<code>lerna.json</code>文件中需要做对应的修改。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;core/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;commands/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;models/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;utils/*&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.6&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>我们删除了原来的packages文件夹, 将里面的<code>core</code>和<code>utils</code>文件夹分别放入core目录和utils目录。</p> <p>因为core模块中安装了utils模块，且路径换了，所以，修改core的package.json文件：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>...
 <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@cdp-wpm/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file:../../utils/utils&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>删除原本两个包中安装的node_modules,重新执行 <code>npm install</code> 完成模块的安装。</p> <p>修改 core/core 为 core/cli, 删除link之后，重新link。</p> <p>安装 import-local 模块，模仿 lerna 脚手架的入口文件配置。</p> <h3 id="core-模块拆分"><a href="#core-模块拆分" class="header-anchor">#</a> core 模块拆分</h3> <p>核心模块 整体分为 3 个阶段</p> <ul><li>准备阶段</li> <li>命令注册</li> <li>命令执行</li></ul> <p>准备阶段的大概流程：</p> <p><img src="/assets/img/07.2aedf86f.png" alt="准备阶段"></p> <h3 id="开发检查版本号的功能"><a href="#开发检查版本号的功能" class="header-anchor">#</a> 开发检查版本号的功能</h3> <p>在node中，使用<code>require</code>函数天生可以加载<code>.js、.json、.node</code>结尾的文件。因此在实现 加载版本号功能的时候，使用了下面的代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../package.json&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这其中还包含一些技术细节:</p> <p>对于node来说:</p> <ul><li>如果解析js结尾的文件的时候，要求我们必须输出一个 module.exports</li> <li>如果解析.json 文件，会直接调用 JSON.parse 方法，解析成一个对象</li> <li>如果是 .node 结尾的文件，会调用C++方法。当成一个模块</li></ul> <p>如果是其他的后缀，会默认使用js引擎去解析，如果解析不了就报错，解析成功就能成功执行。</p> <h3 id="封装-npmlog-方法"><a href="#封装-npmlog-方法" class="header-anchor">#</a> 封装 npmlog 方法</h3> <p>我们需要一个专门的包来打印日志，同样的需要使用lerna进行安装 ，并且在utils目录下创建</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna create @cdp-wpm/log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用上述命令创建的包会创建在 core 目录下，这个应该是lerna的bug，我们还需要修改<code>main</code>对应的入口文件。</p> <p>因为我们需要基于<code>npm-log</code>封装，所以我们需要安装依赖：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna <span class="token function">add</span> npmlog utils/log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装成功后，会在log中看到依赖，但是其他部分并不会看到依赖。这就是使用lerna开发的好处，可以指定目录安装依赖</p> <p>开发log的代码，打印 info 级别的日志。</p> <p>在core模块中引用的时候，我们使用的依然是file协议，所以不要忘记重新在core文件夹中执行<code>npm install</code>安装log依赖。</p> <p>对于npmlog 这个方法包来说, 我们可以自定义方法，使用的和info级别的日志一样，需要借助一个 addLevel 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>log<span class="token punctuation">.</span><span class="token function">addLevel</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">fg</span><span class="token operator">:</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">bold</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>日志的级别是有比较严格的限制的，（第二个参数显示的数字其实就是代表级别的高低）所以我们需要根据当前环境变量来控制日志的级别。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;npmlog&quot;</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>level <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LOG_LEVEL</span> <span class="token operator">?</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LOG_LEVEL</span> <span class="token operator">:</span> <span class="token string">&quot;info&quot;</span>
log<span class="token punctuation">.</span>heading <span class="token operator">=</span> <span class="token string">&quot;cdp-wpm&quot;</span>
log<span class="token punctuation">.</span>headingStyle <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">fg</span><span class="token operator">:</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">bg</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span> <span class="token punctuation">}</span>
log<span class="token punctuation">.</span><span class="token function">addLevel</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">fg</span><span class="token operator">:</span> <span class="token string">&quot;green&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="封装检查node版本的方法"><a href="#封装检查node版本的方法" class="header-anchor">#</a> 封装检查node版本的方法</h3> <p>之所以需要检查node的版本，主要是为了防止因为安装了高版本的node导致某些方法不兼容。</p> <p>因为我们在代码中应该对于node版本做一个判断。</p> <p>这里需要用到1个关键的npm包<code>semver</code>用于版本的判断。</p> <p>在node中，我们可以通过 <code>process.version</code> 来获取当前运行环境的 node 版本号</p> <p>可以创建一个常量来限定一个最低的版本号。</p> <p>semver.gt: 大于
semver.gte: 大于等于</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 检查node版本</span>
<span class="token keyword">function</span> <span class="token function">checkNodeVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取当前版本号 可以使用 process.version</span>
  <span class="token keyword">let</span> currentVersion <span class="token operator">=</span> process<span class="token punctuation">.</span>version
  <span class="token comment">// 从常量中找到配置的最新的版本号</span>
  <span class="token keyword">let</span> loweastNodeVersin <span class="token operator">=</span> constant<span class="token punctuation">.</span><span class="token constant">LOWEAST_NODE_VERSION</span>
  <span class="token comment">// 如果当前版本小于最小的版本警告报错</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>semver<span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">,</span> loweastNodeVersin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
      colors<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cdp-wpm需要安装 v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>loweastNodeVersin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">以上版本的 Node.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="检查root启动"><a href="#检查root启动" class="header-anchor">#</a> 检查root启动</h3> <p>在mac系统中，如果我们使用root权限去创建的一些目录或者文件，作为普通的权限的用户是没有办法进行修改的，这样的操作就会出现问题，因此，我们就需要对这样场景进行<strong>降级操作</strong>，使用普通用户的权限去操作。</p> <p>使用<code>process.geteuid()</code> 这个方法 能够打印我们目前的用户权限。</p> <p>我们这里使用一个npm包<code>root-check</code>, 在<code>core/cli</code>这个目录下进行安装</p> <p>这里需要注意一件事情, 新版本的<code>root-check</code>使用的是<code>ESM</code>规范，不能使用require语法，所以我安装了1.0的版本，解决了这个问题。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// root-check 这个包会检查root账户，如果检查是root账户，就会降级。</span>
<span class="token keyword">function</span> <span class="token function">rootCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rootCheck <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;root-check&quot;</span><span class="token punctuation">)</span>
  <span class="token function">rootCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="检查用户主目录"><a href="#检查用户主目录" class="header-anchor">#</a> 检查用户主目录</h3> <p>这里需要使用到一个包：<code>user-home</code> 用来判断是否是用户的主目录。</p> <p>还需要一个<code>path-exist</code>这个包判断路径是否存在</p> <p>首先还是需要在<code>core/cli</code>路径下执行下这两个库的安装操作。</p> <p>这里需要注意的是 <code>path-exists</code> 应该安装4.0版本，否则更加新的版本是<code>ESM</code>, 在现有的脚手架项目中并不是很好使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 后续会存放一些东西在用户的主目录下。</span>
<span class="token keyword">function</span> <span class="token function">checkUserHome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(userHome) // /Users/louis</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>userHome <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">pathExists</span><span class="token punctuation">(</span>userHome<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">&quot;当前用户主目录不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="处理一些参数问题"><a href="#处理一些参数问题" class="header-anchor">#</a> 处理一些参数问题</h3> <p>对于脚手架来说，可能需要根据输入的参数是否带有<code>--debug</code>来按照不同的标准打印日志。这就需要我们处理参数问题。</p> <p>需要封装一个<code>checkInputArgs</code>的方法用于处理这种场景</p> <p>为了解析参数。我们使用一个仓库 <code>minimist</code>(vue3脚手架的搭建中也有使用)来帮助我们解析入参。</p> <p><a href="https://www.npmjs.com/package/minimist" target="_blank" rel="noopener noreferrer">minimist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>安装好了之后，在命令行输入命令控制台打印：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>➜  cli git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> ✗ cdp-wpm <span class="token parameter variable">--debug</span> <span class="token parameter variable">--help</span>
cdp-wpm info cli <span class="token number">0.0</span>.11
<span class="token punctuation">{</span> _: <span class="token punctuation">[</span><span class="token punctuation">]</span>, debug: true, help: <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">checkInputArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> minimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;minimist&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">// 这种写法已经非常常用，只要参数部分，默认的前两个不需要</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 如果我们在命令后面添加了 --debug 这个命令 {debug:true} 就会写入到 args 这个参数中</span>
  <span class="token function">checkArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">checkArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LOG_LEVEL</span> <span class="token operator">=</span> <span class="token string">&quot;verbose&quot;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LOG_LEVEL</span> <span class="token operator">=</span> <span class="token string">&quot;info&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 在确定好了 log——level 之后重新给他赋值</span>
  log<span class="token punctuation">.</span>level <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LOG_LEVEL</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>上面的函数中，在函数最后修改了 log 的 level的级别，在最后打印的时候 也是生效的。</p> <h3 id="检查环境变量"><a href="#检查环境变量" class="header-anchor">#</a> 检查环境变量</h3> <p>环境变量非常有用，一些用户的信息可以存在配置文件中。不用写在代码中。</p> <p>这里需要使用到一个npm库<code>dotenv</code>非常好用。</p> <p>这个仓库的使用也是比较简单，拥有一个 config 方法，调用方式类似于这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dotenv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认情况下, 是获取 下的 <code>.env</code> 文件, 如果想要获取用户主目录下面.</p> <p>最终想要实现的效果是： <code>{ home: '/Users/louis', cliHome: '/Users/louis/.cdp-wpm' }</code></p> <p>在mac中 使用 cd ~ 命令就能够快速进入用户主目录。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 检查环境变量</span>
<span class="token keyword">function</span> <span class="token function">checkEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取用户的主目录</span>
  <span class="token keyword">const</span> dotenvPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>userHome<span class="token punctuation">,</span> <span class="token string">&quot;.env&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pathExists</span><span class="token punctuation">(</span>dotenvPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用这种方式能将配置文件中的变量放入 process.env中</span>
    <span class="token comment">// 执行完毕这个代码之后，process.env.CLI_HOME_PATH 就已经可以拿到了</span>
    <span class="token comment">// dotenv 这个库确实很好用</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dotenv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> dotenvPath<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 有时候用户本地是没有 缓存主目录的，我们可以做一些判断</span>
  <span class="token comment">// 如果用户本地没有缓存主目录，我们可以帮他生成一个</span>
  config <span class="token operator">=</span> <span class="token function">createDefaultConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 打印缓存主目录</span>
  <span class="token comment">// console.log(process.env.CLI_HOME_PATH) =&gt; /Users/louis/.cdp-wpm</span>
<span class="token punctuation">}</span>

<span class="token comment">// 针对没有设置缓存主目录</span>
<span class="token keyword">function</span> <span class="token function">createDefaultConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cliConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">home</span><span class="token operator">:</span> userHome<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CLI_HOME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cliConfig<span class="token punctuation">[</span><span class="token string">&quot;cliHome&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>userHome<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CLI_HOME</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    cliConfig<span class="token punctuation">[</span><span class="token string">&quot;cliHome&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>userHome<span class="token punctuation">,</span> constant<span class="token punctuation">.</span><span class="token constant">DEFAULT_CLI_HOME</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将生成的path直接赋值给 环境变量</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CLI_HOME_PATH</span> <span class="token operator">=</span> cliConfig<span class="token punctuation">.</span>cliHome
  <span class="token keyword">return</span> cliConfig
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>这里面还学习到了一个 vim 操作的小技巧。</p> <ul><li>如何删除一行: 使用dd</li> <li>如果撤销操作: 使用u</li> <li>如何快速复制一行: 使用yy</li> <li>如何将复制的一行黏贴出来: 使用p</li></ul> <h3 id="检查是否为最新版本"><a href="#检查是否为最新版本" class="header-anchor">#</a> 检查是否为最新版本</h3> <p>当我们检查本地的脚手架已经不是最新版本的时候，要给出用户提示，是否升级新的版本。</p> <p>这个检查是否全局更新的功能逻辑梳理：</p> <ul><li>获取最近的版本号和模块名</li> <li>调用npm api 获取所有的版本号使用通用的apihttps://registry.npmjs.org/@cdp-wpm/core</li> <li>提取所有的版本号，比对哪些版本号是大于当前版本号的</li> <li>给出最新的版本号，提示用户更新到该版本</li></ul> <p>封装调用npm的方法，单独起一个包</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lerna create @cdp-wpm/get-npm-info ./utils/get-npm-info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里发现lerna的一个bug, 就是它会默认安装到<code>lerna.json</code>配置文件的第一个目录下，比如说我的配置是</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;core/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;utils/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;commands/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;models/*&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.12&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>那么就会默认安装在core目录下，为此，我还修改了这个配置顺序</p> <p><code>get-npm-info</code> 作为一个单独的npm包来使用。单独发布到npm上面。</p> <p>因为我们要发起一个请求，所以需要在<code>utils</code>中安装<code>axios</code>这个仓库。</p> <p>为了拼接url我们还可以安装一个npm包 <code>url-join</code> 节省我们的工作量。</p> <p>从npm官方中拉取版本号的信息，拉取信息之后主要比对当前的版本号和最新的版本号之间的差距。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 检查最新的版本号</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkGlobalUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1、获取当前的版本号和模块名称，这些信息都是可以从 package.json 文件中获取</span>
  <span class="token keyword">const</span> currentVersion <span class="token operator">=</span> pkg<span class="token punctuation">.</span>version
  <span class="token keyword">const</span> npmName <span class="token operator">=</span> pkg<span class="token punctuation">.</span>name

  <span class="token comment">// 2、获取npm的信息 调用npm api</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> getNpmSemverVersion <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@cdp-wpm/get-npm-info&quot;</span><span class="token punctuation">)</span>

  <span class="token comment">// 3、提取所有的版本号，比对哪些版本号是大于当前版本号</span>
  <span class="token keyword">const</span> lastVersion <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNpmSemverVersion</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">,</span> npmName<span class="token punctuation">)</span>

  <span class="token comment">// 4、获取最新的版本号，提示用户更新到该版本</span>
  <span class="token comment">// 如果从线上获取的版本大于当前的版本 提示用户更新</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lastVersion <span class="token operator">&amp;&amp;</span> semver<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span>lastVersion<span class="token punctuation">,</span> currentVersion<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
      colors<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请手动更新 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>npmName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 当前版本:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currentVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 最新版本:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>在获取npm版本号的时候，如果为了保险，应该是对过滤出来的版本号再做下排序的处理。这样比较保险。</p> <h2 id="注册命令逻辑"><a href="#注册命令逻辑" class="header-anchor">#</a> 注册命令逻辑</h2> <p><a href="/cli/注册命令.html">注册命令</a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">7/27/2022, 8:21:57 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a11ed61a.js" defer></script><script src="/assets/js/2.68fcfb69.js" defer></script><script src="/assets/js/4.3dd36c4a.js" defer></script>
  </body>
</html>
